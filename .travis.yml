RELEASE_TAGdist: trusty
sudo: false
notifications:
  email: false
env:
- RELEASE_TAG="release-$TRAVIS_BUILD_NUMBER"
if: tag IS blank


jobs:
  include:
  - stage: build and publish
    language: java
    jdk: openjdk8
    install: skip
    script: ./gradlew clean build
    before_deploy:

    - git config --local user.name "Travis CI"
    - git config --local user.email "travis@example.com"
    - git tag -f "release-$TRAVIS_BUILD_NUMBER"
    deploy:
      provider: releases
      api_key:  b0d7e523fbe5acc7dcd32d00c529732b518f5ba2
      file: "build/libs/pal-tracker.jar"
      skip_cleanup: true
  - stage: deploy to cf
    language: bash
    script:
    - echo "Downloading "release-$TRAVIS_BUILD_NUMBER""
    - wget -P build/libs https://github.com/$GITHUB_USERNAME/pal-tracker/releases/download/"release-$TRAVIS_BUILD_NUMBER"/pal-tracker.jar
    before_deploy:
    - echo "Deploying "release-$TRAVIS_BUILD_NUMBER" to Cloud Foundry"
    deploy:
      provider: cloudfoundry
      api: api.sys.evans.pal.pivotal.io
      username: vismaya.t33@wipro.com
      password: dms8s96p
      organization: vismaya.t33.wipro.com
      space: sandbox
